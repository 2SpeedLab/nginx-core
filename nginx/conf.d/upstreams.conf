# Upstream Configuration
# Place this in /etc/nginx/conf.d/upstreams/

upstream backend_servers {
    least_conn;

    server 127.0.0.1:8001 max_fails=3 fail_timeout=30s;
    server 127.0.0.1:8002 max_fails=3 fail_timeout=30s;
    server 127.0.0.1:8003 max_fails=3 fail_timeout=30s;

    keepalive 32;
}

upstream api_backend {
    ip_hash;

    server 127.0.0.1:9001 max_fails=2 fail_timeout=10s;
    server 127.0.0.1:9002 max_fails=2 fail_timeout=10s;

    keepalive 16;
}
