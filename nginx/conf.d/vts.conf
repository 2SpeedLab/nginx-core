# vts.conf
# VTS (Virtual Host Traffic Status) Module Configuration
# Include this file in the http block of nginx.conf

# Enable VTS module
vhost_traffic_status_zone shared:vhost_traffic_status:32m;

# Filter traffic by host
vhost_traffic_status_filter_by_host on;

# Configure histogram buckets for request/response time tracking
# Values in seconds: 5ms, 10ms, 50ms, 100ms, 500ms, 1s, 5s, 10s
vhost_traffic_status_histogram_buckets 0.005 0.01 0.05 0.1 0.5 1 5 10;

# Filter by URI (tracks per-URI statistics)
# Format: $variable name::pattern
vhost_traffic_status_filter_by_set_key $uri uri::*;

# Optional: Filter by request method
# vhost_traffic_status_filter_by_set_key $request_method method::*;

# Optional: Filter by status code
# vhost_traffic_status_filter_by_set_key $status status::*;

# Optional: Limit number of URIs tracked (prevents memory overflow)
# FGC = Filter Group Counter
# This limits to top 1000 URIs by request count
# vhost_traffic_status_limit_traffic_by_set_key FGC:$uri uri::1000;

# Shared dictionary for VTS statistics cache
lua_shared_dict vts_stats 10M;